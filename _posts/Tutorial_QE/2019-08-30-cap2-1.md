---
title: "Tutorial Quantum ESPRESSO: Obtendo a estrutura de equilíbrio"
date: 2019-08-30
tags: [QE, Tutorial]
classes: wide
header:
  teaser: images/posts/tutorial_qe/logo_header.jpg
excerpt: "Obtendo a estrutura de equilíbrios"
mathjax: "true"
---

Geralmente quando desejamos fazer qualquer tipo de cálculo com determinada estrutura, precisamos que ela esteja em seu estado de equilíbrio, *i. e.* as forças entre os átomos são as menores possíveis e a energia total é um mínimo na superfície de potencial. Mesmo quando desejamos fazer cálculos com um material que já possui sua estrutura determinada por difração de raios-X ou por RMN, precisamos otimizar a estrutura para o nível em que estamos fazendo o cálculo. Existem algumas maneiras de fazer esse processo de otimização, que em geral se resume a determinar a **superfície de energia potencial** dos íons e procurar nessa superfície por mínimos globais. Para casos simples, veremos que podemos fazer esse processo manualmente. Já para casos mais complexos recorreremos a algoritmos poderosos para procurar esse mínimo de maneira automatizada.

# Sistemas moleculares (0D)

O nosso objetivo principal é determinar a estrutura que corresponda a um mínimo na superfície de energia potencial. Para explorar esse conceito vamos olhar para um caso simples, que apesar de não ser periódico é bastante instrutivo: A molécula de $$N_2$$. Experimentalmente observa-se que o comprimento da ligação dessa molécula é de 1.0975 Å [1]. Dessa forma, podemos construir a curva de energia potencial fazendo um gráfico da energia em função da distância de ligação entre os átomos $$d_{N-N}$$.

Para isso, crie um *script* de submissão como o abaixo:

```bash
D_NN = '0.878'
PREFIX="n2_$D_NN"
PSEUDO_DIR="/home/pseudo"
CALC="scf"
CMD_PW="mpirun -np 4 /home/interlab/qe/bin/pw.x -nk 1"

#Make SCF calculation
cat>$PREFIX.$CALC.in<<EOF
 &control
	calculation = '$CALC' ,
	restart_mode = 'from_scratch' ,
	wf_collect = .false. ,
	outdir = '.' ,
	pseudo_dir = '$PSEUDO_DIR' ,
	prefix = '$PREFIX' ,
 /
 &system
	ibrav = 1 	celldm(1) = 20
	nat =  2 ,	ntyp = 1 ,
	ecutwfc = 80.0 ,	ecutrho = 600.0 ,
 /
 &electrons
	conv_thr =  1.0D-10 ,	electron_maxstep = 5000 ,
 /
ATOMIC_SPECIES
	N   14.0107  N.pbe-van_ak.UPF
ATOMIC_POSITIONS (angstrom)
	N        0.000000000   0.000000000   0.000000000
	N        $D_NN         0.000000000   0.000000000
K_POINTS automatic
	1 1 1   0 0 0
EOF
$CMD_PW < $PREFIX.$CALC.in > $PREFIX.$CALC.out
```

Execute o cálculo editando a variável D_NN, modificando posição do segundo átomo de nitrogênio seguindo os valores: 0.8780 0.9011 0.9242 0.9473 0.9704 0.9935 1.0166 1.0397 1.0628 1.08596 1.1090 1.1321 1.1552 1.1783 1.2014 1.2245 1.2476 1.2707 1.2938 1.3170.

Como o primeiro átomo de nitrogênio está na origem, a posição do segundo átomo nos dará exatamente o tamanho da ligação. Perceba que estamos fazendo o cálculo para uma molécula isolada, entretanto o QE lida com sistemas periódicos. Para que possamos fazer o cálculo sem menores problemas, vamos considerar uma célula unitária bem grande e um grande espaço vazio entre as moléculas, chamado de *slab*, de forma que as moléculas de nitrogênio dentro da caixa não consigam interagir com as moléculas das caixas vizinhas. Além disso podemos fazer o cálculo considerando somente 1 *k-point* para x, y e z.

Em seguida, crie um gráfico com os valores da ligação no eixo $$x$$ e os valores da energia total no eixo $$y$$. Você deve obter um gráfico parecido com o mostrado abaixo:

<img src="{{ site.url }}{{ site.baseurl }}/images/posts/tutorial_qe/n2_curve.png" alt="Energia em função da distância de ligação">

**Figura 1:** Energia em função da distância de ligação, $$E(d_{N-N})$$ para a molécula de $$N_2$$. Os pontos vermelhos são os valores calculados, a linha preta um ajuste de um potencial de Morse e a linha azul o ajuste de um potencial harmônico.


Podemos expandir a função energia total ($$U(x)$$) como uma série de Taylor, na forma:

$$U(x) = \sum_{n=0}^{\infty} \frac{E^{(n)}(x_0)}{n!} (x - x_0)^n \approx U(x_0) + U^\prime (x_0)(x - x_0) + \frac{1}{2} U^{\prime \prime} (x_0)(x - x_0)^2 + \frac{1}{6} U^{\prime \prime \prime} (x_0)(x - x_0)^3 + ...$$

Se considerarmos o caso em que temos valores de deslocamento muito próximos do valor de equilíbrio, *i.e.* $$x\approx x_0$$, teremos $$U(x_0)=0$$. Desconsiderando os termos de terceira ordem e de ordem superior, ficamos com:

$$U^{H}(x) = \frac{1}{2}k(x-x_0)^2 + U_0, \qquad U^{\prime \prime} (x_0) = k \quad e \quad U(x_0)=U_0$$

Essa é a equação de um oscilador harmônico. Esse é um modelo simplificado que é largamente utilizado para representar a ligação entre dois átomos, *i.e* considerando um sistema massa mola com constante de mola $$k$$ oscilando em torno da distância de equilíbrio $$x_0$$. Podemos tirar algumas informações úteis da curva apresentada na equação acima, com um certo tratamento desses dados.

  * Tente fazer um ajuste não linear da equação do oscilador harmônico. O ajuste ficou bom?
    * R: $$k = 11.868916$$, $$x_0 = 1.118449$$, $$U_0 = -40.923906$$, $$R^2 = 0.987123$$      

  * Tente agora fazer o ajuste não linear somente com os dados entre o 8° e 17° pontos. Melhorou ou piorou?
    * R: $$k = 10.675229$$, $$x_0 = 1.111322$$, $$U_0 = -40.921885$$,  $$R^2 = 0.998037$$

  * Qual o significado físico das constantes $$k$$, $$V_0$$ e $$x_0$$?

O potencial de Morse pode ser uma escolha conveniente para modelar a energia potencial da interação entre átomos e moléculas diatômicas. É uma aproximação mais realista para a estrutura vibracional e considera a anarmonicidade que ligações químicas reais apresentam. A equação da função de energia potencial de Morse é:

$$U^{M}(r) = D_e(1 - e^{-a(r - r_e)})^2 + U_0$$

onde $$r$$ é a distância interatômica, $$r_e$$ a distância de equilíbrio da ligação, $$D_e$$ é a profundidade do poço de potencial (energia de dissociação + energia de ponto zero), $$a$$ controla a "abertura" do poço, sendo $$a = \sqrt{k_e/2D_e}$$ com $$k_e$$ sendo a constante de força do oscilador e $$U_0$$ a energia dos átomos infinitamente isolados.

  * Faça o ajuste do potencial de Morse nos dados calculados e obtenha a distância de equilíbrio e $$D_e$$. Compare o $$d_{NN}$$ obtido pelo ajuste com o valor experimental. Qual a discrepância relativa. O valor calculado é bom ou ruim?
    * R: $$D_e = 0.815555$$, $$r_e = 1.110075$$, $$a = 2.522660$$, $$U_0 = -40.921848$$, $$R^2 = 0.999999$$, 1.15%}
  * Qual a constante de força do oscilador?
    * R: 10.38
  * Compare o $$R^2$$ e os dados obtidos do ajuste do oscilador harmônico e da equação de Morse. Qual se ajusta melhor? Que consequências podemos tirar desse resultado?

Agora, note que o nitrogênio possui configuração eletrônica $$[1s^2]2s^22p^3$$, e em seu estado fundamental, segundo a regra de Hund, apresenta spin S=3/2:  $$2s$$ $$\framebox[.25in]{$\downarrow \uparrow$}$$  $$2p$$ $$\framebox[.25in]{$\uparrow$}$$ $$\framebox[.25in]{$\uparrow$}$$ $$\framebox[.25in]{$\uparrow$}$$, tendo assim termo espectroscópico $$^4S_{3/4}$$ Nos cálculos que fizemos até agora, não levamos isso em consideração. Para pequenas variações  da distância de equilíbrio não há uma grande influência pois a ligação está formada e os spins estão acoplados na formação da ligação. Entretanto, se quisermos calcular a energia de formação da molécula com precisão precisamos fazer um cálculo *spin-polarizado*.

> As regras de Hund, conjunto de regras formuladas em 1927 pelo físico alemão Friedrich Hund, é uma forma de determinar o termo espectroscópico ($$^{2S+1}L_J$$) correspondente ao estado fundamental de um átomo polieletrônico. São elas:
  * Para uma dada configuração eletrônica, o termo com máxima multiplicidade apresenta a menor energia. A multiplicidade é definida como $$2S+1$$ onde $$S$$ é o momento angular de spin total;
  * Para uma dada multiplicidade, o termo com maior valor do número quântico de momento angular orbital, $$L$$ apresenta menor energia;
  * Para um determinado termo, em um átomo com sub-camada mais externa com metade do preenchimento ou menos, o nível com o valor mais baixo do número quântico do momento angular total $$J=L + S$$, apresenta a energia mais baixa. Se a camada mais externa estiver mais da metade preenchida, o nível com o valor mais alto de $$J$$ é o mais baixo em energia.

Para esse tipo de cálculo vamos modificar o *script* como o apresentado à seguir, adicionando as variáveis **nspin=2** para informar que o cálculo é *spin-polarizado*, **tot_magnetization = 3.0** para um spin total de 3 magnetons de Bohr.

```bash
#!/bin/bash

PREFIX="N"
PSEUDO_DIR="/home/pseudo"
CALC="scf"
CMD_PW="mpirun -np 4 /home/interlab/qe/bin/pw.x"

#Make SCF calculation
cat>$PREFIX.$CALC.in<<EOF
 &control
    calculation = '$CALC' ,
    restart_mode = 'from_scratch' ,
    wf_collect = .false. ,
    outdir = '.' ,
    pseudo_dir = '$PSEUDO_DIR' ,
    prefix = '$PREFIX' ,
/
&system
    ibrav = 1 	celldm(1) = 20
    nat =  1 ,	ntyp = 1 ,
    ecutwfc = 80.0 ,	ecutrho = 600.0 ,
    nspin = 2, tot_magnetization = 3.0, occupations = smearing,
    degauss = 0.001,
/
&electrons
    conv_thr =  1.0D-10 ,	electron_maxstep = 5000 ,
/
ATOMIC_SPECIES
    N   14.0107  N.pbe-van_ak.UPF
ATOMIC_POSITIONS (angstrom)
    N        0.000000000   0.000000000   0.000000000
K_POINTS automatic
    1 1 1   0 0 0
EOF
$CMD_PW < $PREFIX.$CALC.in > $PREFIX.$CALC.out
```

Ao executarmos esse cálculo veremos que a energia total calculada para o átomo de Nitrogênio no estado fundamental $$^4S_{3/4}$$ é de -20.08714260 Ry.

> O valor absoluto das energias calculadas (autovalores das equações de Kohn-Sham) não possuem nenhum significado físico. Somente diferenças de energias, sempre calculadas no mesmo nível de cálculo, podem ser comparadas com valores experimentais. Por esse motivo, sempre que vamos reportar dados subtraímos de todos os valores o $$U_0$$ obtido do ajuste e renomeamos o eixo *y* para **Energia de formação**.

[1] BOWEN, Humphrey John Moule. Tables of interatonic distances and configuration in molecules and ions. 1958.
